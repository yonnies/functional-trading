<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contract Evaluator</title>
  <link rel="stylesheet" href="style.css"> </head>
</head>
<body>
  <h1>Contract Evaluator</h1>
  <select id="contractDropdown">
    <option value="">Select a contract...</option>
    <option value="europeanStockCall">European Stock Call</option>
    <option value="europeanStockPut">European Stock Put</option>
    <option value="americanStockCall">American Stock Call</option>
    <option value="americanStockPut">American Stock Put</option>
    <option value="zcdb">Zero-Coupon Bond</option>
    <option value="upAndInOption">Up-and-In Option</option>
    <option value="downAndInOption">Down-and-In Option</option>
    <option value="shortfallGrainYieldC">Shortfall Grain Yield</option>
    <option value="customContract">Custon Contract</option>
  </select>
  <div id="parameters"></div>
  <button id="evaluateButton">Evaluate</button>
  <div id="result"></div>

  <script>
    const contractDropdown = document.getElementById('contractDropdown');
    const parametersDiv = document.getElementById('parameters');
    const evaluateButton = document.getElementById('evaluateButton');
    const resultDiv = document.getElementById('result');
  
    // List of currencies and stocks
    const currencies = ["GBP", "USD", "EUR", "BGN"];
    const stocks = ["DIS", "TSLA", "NVDA", "MSFT", "RACE", "AAPL"];
  
    // Update parameters based on selected contract
    contractDropdown.addEventListener('change', () => {
      const contractType = contractDropdown.value;
      parametersDiv.innerHTML = ''; // Clear previous inputs
  
      let inputs = [];
      switch (contractType) {
        case 'europeanStockCall':
        case 'europeanStockPut':
        case 'americanStockCall':
        case 'americanStockPut':
          inputs = ['Date', 'Strike Price', 'Stock'];
          break;
        case 'zcdb':
          inputs = ['Date', 'Value', 'Currency'];
          break;
        case 'upAndInOption':
        case 'downAndInOption':
          inputs = ['Barrier Price', 'Stock', 'Payoff'];
          break;
        case 'shortfallGrainYieldC':
          inputs = ['Date', 'Goal Yield', 'Actual Yield'];
          break;
        case 'customContract':
          inputs = ['Custom Contract'];
          break;
      }
  
      inputs.forEach(label => {
      const inputWrapper = document.createElement('div');
      inputWrapper.style.marginBottom = '10px';

      const inputLabel = document.createElement('label');
      inputLabel.textContent = label;
      inputLabel.style.display = 'block';

      let input;
      if (label === 'Date') {
        // Create a date input field
        input = document.createElement('input');
        input.type = 'date';

        // Set the minimum date to today
        const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format
        input.min = today;
      } else if (label === 'Currency') {
        // Create a dropdown for currencies
        input = document.createElement('select');
        currencies.forEach(currency => {
          const option = document.createElement('option');
          option.value = currency;
          option.textContent = currency;
          input.appendChild(option);
        });
      } else if (label === 'Stock') {
        // Create a dropdown for stocks
        input = document.createElement('select');
        stocks.forEach(stock => {
          const option = document.createElement('option');
          option.value = stock;
          option.textContent = stock;
          input.appendChild(option);
        });
      } else {
        // Create a numeric input field for other parameters
        input = document.createElement('input');
        input.type = 'text'; // Use text input for the custom field
      }

      inputWrapper.appendChild(inputLabel);
      inputWrapper.appendChild(input);
      parametersDiv.appendChild(inputWrapper);
    });
    });
  
    // Send evaluation request
    evaluateButton.addEventListener('click', async () => {
      const contractType = contractDropdown.value;
      const inputs = Array.from(parametersDiv.querySelectorAll('input, select')).map(input => input.value);
  
      // Log a message to the browser console
      console.log(`Sending request to back end: contractType=${contractType}, inputs=${inputs}`);
  
      try {
        const response = await fetch('http://localhost:12125/evaluate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contractType, parameters: inputs })
        });
  
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
  
        const result = await response.json();
        resultDiv.textContent = result.result;
  
        // Log a message to the browser console after receiving the response
        console.log('Response received from back end:', result);
      } catch (error) {
        console.error('Error communicating with the back end:', error);
        alert('Failed to communicate with the back end. Please try again.');
      }
    });
  </script>
</body>
</html>